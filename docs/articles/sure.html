<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to surrogate residuals in R • sure</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to surrogate residuals in R">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sure</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/sure.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/koalaverse/sure">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to surrogate residuals in R</h1>
                        <h4 class="author">Brad Boehmke &amp; Brandon Greenwell</h4>
            
            <h4 class="date">2018-07-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/koalaverse/sure/blob/master/vignettes/sure.Rmd"><code>vignettes/sure.Rmd</code></a></small>
      <div class="hidden name"><code>sure.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Categorical outcomes are encountered frequently in practice across different fields. For example, in medical studies, the outcome of interest is often binary (e.g., presence or absence of a particular disease after applying a treatment). In other studies, the outcome may be an ordinal variable; that is, a categorical outcome having a natural ordering. For instance, in an opinion poll, the response may be satisfaction, with categories low, medium, and high. In this case, the response is ordered: low <span class="math inline">\(&lt;\)</span> medium <span class="math inline">\(&lt;\)</span> high.</p>
<p>Logistic and probit regression are popular choices for modelling a binary outcome. Although this paper focuses on models for ordinal responses, the surrogate approach to constructing residuals actually applies to a wide class of general models of the form</p>
<p><span class="math display">\[
  \mathcal{Y} \sim F_a\left(y; \boldsymbol{X}, \boldsymbol{\beta}\right), 
\]</span></p>
<p>where <span class="math inline">\(F_a\left(\cdot\right)\)</span> is a discrete cumulative distribution function, <span class="math inline">\(\boldsymbol{X}\)</span>, is an <span class="math inline">\(n \times p\)</span> model matrix, and <span class="math inline">\(\boldsymbol{\beta}\)</span> is a <span class="math inline">\(p \times 1\)</span> vector of unknown regression coefficients. This includes binary regression as a special case. For example, the probit model has</p>
<p><span class="math display">\[
  \mathcal{Y} \sim Bernoulli\left[\Phi\left(\boldsymbol{X}^\top\boldsymbol{\beta}\right)\right], 
\]</span></p>
<p>where <span class="math inline">\(\Phi\left(\cdot\right)\)</span> is the cumulative distribution function for the standard normal distribution.</p>
<p>The <em>cumulative link model</em> is a natural choice for modelling a binary or ordinal outcome. Consider an ordinal categorical outcome <span class="math inline">\(\mathcal{Y}\)</span> with ordered categories <span class="math inline">\(1 &lt; 2 &lt; \dots &lt; J\)</span>. In a cumulative link model, the cumulative probabilities are linked to the predictors according to</p>
<p><span class="math display">\[
  G^{-1}\left(\Pr\left\{\mathcal{Y} \le j\right\}\right) = \alpha_j + f\left(\boldsymbol{X}, \boldsymbol{\beta}\right), \tag{1}
\]</span></p>
<p>where <span class="math inline">\(G\left(\cdot\right)\)</span> is a continuous cumulative distribution function, <span class="math inline">\(\alpha_j\)</span> are the category-specific intercepts, <span class="math inline">\(\boldsymbol{X}\)</span> is a matrix of covariates, and <span class="math inline">\(\boldsymbol{\beta}\)</span> is a vector of fixed regression coefficients. The intercept parameters satisfy <span class="math inline">\(-\infty = \alpha_0 &lt; \alpha_1 &lt; \dots &lt; \alpha_{J-1} &lt; \alpha_J = \infty\)</span>. We should point out that some authors (and software) use the alternate formulation</p>
<p><span class="math display">\[
  G^{-1}\left(\Pr\left\{\mathcal{Y} \ge j\right\}\right) = \alpha_j^\star + f\left(\boldsymbol{X}, \boldsymbol{\beta}^\star\right). \tag{2}
\]</span></p>
<p>This formulation provides coefficients that are consistent with the ordinary logistic regression model. The estimated coefficients from model (2) will have the opposite sign as those in model (1); see, for example, <span class="citation">Agresti (2010)</span>.</p>
<p>Another way to interpret the cumulative link model is through a <em>latent</em> continuous random variable <span class="math inline">\(\mathcal{Z} = -f\left(\boldsymbol{X}, \boldsymbol{\beta}\right) + \epsilon\)</span>, where <span class="math inline">\(\epsilon\)</span> is a continuous random variable with location parameter <span class="math inline">\(0\)</span>, scale parameter <span class="math inline">\(1\)</span>, and cumulative distribution function <span class="math inline">\(G\left(\cdot\right)\)</span>. We then construct an ordered factor according to the rule</p>
<p><span class="math display">\[
  y = j \quad if \quad \alpha_{j - 1} &lt; z \le \alpha_j. 
\]</span></p>
<p>For <span class="math inline">\(\epsilon \sim N\left(0, 1\right)\)</span>, this leads to the usual probit model for ordinal responses,</p>
<p><span class="math display">\[
  \Pr\left\{\mathcal{Y} \le j\right\} = \Pr\left\{\mathcal{Z} \le \alpha_j\right\} = \Pr\left\{-f\left(\boldsymbol{X}, \boldsymbol{\beta}\right) + \epsilon \le \alpha_j\right\} = \Phi\left(\alpha_j + f\left(\boldsymbol{X}, \boldsymbol{\beta}\right)\right). 
\]</span></p>
<p>Common choices for the link function <span class="math inline">\(G^{-1}\left(\cdot\right)\)</span> and the implied (standard) distribution for <span class="math inline">\(\epsilon\)</span> are described in Table 1.</p>
<table class="table">
<colgroup>
<col width="13%">
<col width="28%">
<col width="28%">
<col width="28%">
</colgroup>
<thead><tr class="header">
<th>Link</th>
<th>Distribution of <span class="math inline">\(\epsilon\)</span>
</th>
<th><span class="math inline">\(G\left(y\right)\)</span></th>
<th><span class="math inline">\(G^{-1}\left(p\right)\)</span></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>logit</td>
<td>logistic</td>
<td><span class="math inline">\(\exp\left(y\right) / \left[1 + \exp\left(y\right)\right]\)</span></td>
<td><span class="math inline">\(\log\left[p / \left(1 - p\right)\right]\)</span></td>
</tr>
<tr class="even">
<td>probit</td>
<td>standard normal</td>
<td><span class="math inline">\(\Phi\left(y\right)\)</span></td>
<td><span class="math inline">\(\Phi^{-1}\left(p\right)\)</span></td>
</tr>
<tr class="odd">
<td>log-log</td>
<td>Gumbel (max)</td>
<td><span class="math inline">\(\exp\left[-\exp\left(-y\right)\right]\)</span></td>
<td><span class="math inline">\(-\log\left[-\log\left(p\right)\right]\)</span></td>
</tr>
<tr class="even">
<td>complementary log-log</td>
<td>Gumbel (min)</td>
<td><span class="math inline">\(1 - \exp\left[-\exp\left(y\right)\right]\)</span></td>
<td><span class="math inline">\(\log\left[-\log\left(1 - p\right)\right]\)</span></td>
</tr>
<tr class="odd">
<td>cauchit</td>
<td>Cauchy</td>
<td><span class="math inline">\(\pi^{-1} \arctan\left(y\right) + 1/2\)</span></td>
<td><span class="math inline">\(\tan\left(\pi p - \pi / 2\right)\)</span></td>
</tr>
</tbody>
</table>
<p>Table 1: Common link functions. <strong>Note:</strong> the logit is typically the default link function used by most statistical software. <br></p>
<p>There are a number of R packages that can be used to fit cumulative link models (1) and (2). The recommended package <strong>MASS</strong> <span class="citation">(Venables and Ripley 2002)</span> contains the function <code>polr</code> (proportional odds logistic regression) which, despite the name, can be used with all of the link functions described in Table 1. The <strong>VGAM</strong> package <span class="citation">(Yee 2017)</span> has the <code>vglm</code> function for fitting vector generalized linear models, which includes the broad class of cumulative link models. By default, <code>vglm</code> uses the same parameterization as in Equation (1), but provides the option of using the parameterization seen in Equation (2); this will result in the estimated coefficients having the opposite sign. Package <strong>ordinal</strong> <span class="citation">(Christensen 2015)</span> has the <code>clm</code> function for fitting cumulative link models. The popular <strong>rms</strong> package <span class="citation">(Harrell Jr 2017)</span> has two functions: <code>lrm</code> for fitting logistic regression and cumulative link models using the logit link, and <code>orm</code> for fitting ordinal regression models. Both of these functions use the parameterization seen in Equation (2).</p>
<p>Next, we introduce the idea of <em>surrogate residuals</em> <span class="citation">(D. Liu and Zhang 2017)</span> and talk about some important properties. We then introduce the <strong>sure</strong> package, discuss the various modelling packages it supports, and demonstrate how <strong>sure</strong> can be used to detect misspecified mean structures, detect heteroscedasticity, detect misspecified link functions, check the proportionality assumption, and detecting interaction effects, respectively. The last section provides a real data analysis example involving the bitterness of wine.</p>
</div>
<div id="surrogate-residuals" class="section level2">
<h2 class="hasAnchor">
<a href="#surrogate-residuals" class="anchor"></a>Surrogate residuals</h2>
<p>For a continuous outcome <span class="math inline">\(\mathcal{Y}\)</span>, the residual is traditionally defined as the difference between the observed and fitted values. For ordinal outcomes, the residuals are more difficult to define, and few definitions have been proposed in the literature. <span class="citation">I. Liu et al. (2009)</span> propose using the cumulative sums of residuals derived from collapsing the ordered categories into multiple binary outcomes. Unfortunately, this method leads to multiple residuals for the ordinal outcome and therefore is difficult to interpret. <span class="citation">Li and Shepherd (2012)</span> show that the sign-based statistic (SBS)</p>
<p><span class="math display">\[
  R_{SBS} = E\left\{sign\left(y - \mathcal{Y}\right)\right\} = Pr\left\{y &gt; \mathcal{Y}\right\} - Pr\left\{y &lt; \mathcal{Y}\right\} \tag{3}
\]</span></p>
<p>can be used as a residual for ordinal outcomes; these are referred to later by <span class="citation">Li and Shepherd (2012)</span> as <em>probability-based residuals</em>, but we will follow <span class="citation">D. Liu and Zhang (2017)</span> and refer to them as SBS residuals. For an overview of the theoretical and graphical properties of the SBS residual (3), see <span class="citation">D. Liu and Zhang (2017)</span>. These are available in the <strong>PResiduals</strong> package <span class="citation">(Dupont et al. 2016)</span>. A limitation with the SBS residuals is that they are based on a discrete outcome and hence, are discrete themselves. This makes using them in various diagnostic plots far less useful.</p>
<p><span class="citation">D. Liu and Zhang (2017)</span> propose a new type of residual that is based on a continuous variable <span class="math inline">\(S\)</span> that acts as a surrogate for the ordinal outcome <span class="math inline">\(\mathcal{Y}\)</span>. This surrogate residual is defined as</p>
<p><span class="math display">\[ R_S = S - E\left(S | \boldsymbol{X}\right), \tag{4} \]</span></p>
<p>where <span class="math inline">\(S\)</span> is a continuous variable based on the conditional distribution of the latent variable <span class="math inline">\(\mathcal{Z}\)</span> given <span class="math inline">\(\mathcal{Y}\)</span>. In particular, given <span class="math inline">\(\mathcal{Y} = y\)</span>, <span class="citation">D. Liu and Zhang (2017)</span> show that <span class="math inline">\(S\)</span> follows a truncated distribution obtained by truncating the distribution of <span class="math inline">\(\mathcal{Z} = -f\left(\boldsymbol{X}, \boldsymbol{\beta}\right) + \epsilon\)</span> using the interval <span class="math inline">\(\left(\alpha_{y - 1}, \alpha_y\right)\)</span>. The benefit of the surrogate residual (Eq. 4) is that it is based on a continuous variable <span class="math inline">\(S\)</span>, hence, <span class="math inline">\(R_S\)</span> is also continuous.</p>
<p>Furthermore, it can be shown <span class="citation">(D. Liu and Zhang 2017)</span> that if the hypothesized model agrees with the true model, then <span class="math inline">\(R_S\)</span> will have the following properties:</p>
<ol style="list-style-type: decimal">
<li>
<strong>symmetry around zero</strong>: <span class="math inline">\(E\left(R_S | \boldsymbol{X}\right) = 0\)</span>;</li>
<li>
<strong>homogeneity</strong>: <span class="math inline">\(Var\left(R_S | \boldsymbol{X}\right) = c\)</span>, a constant that is independent of <span class="math inline">\(\boldsymbol{X}\)</span>;</li>
<li>
<strong>reference distribution</strong>: the empirical distribution of <span class="math inline">\(R_S\)</span> approximates an explicit distribution that is related to the link function <span class="math inline">\(G^{-1}\left(\cdot\right)\)</span>. In particular, independent of <span class="math inline">\(\boldsymbol{X}\)</span>, <span class="math inline">\(R_S \sim G\left(c + \int udG(u)\right)\)</span>, where <span class="math inline">\(c\)</span> is a constant.</li>
</ol>
<p>According to property (a), if <span class="math inline">\(\int u dG\left(u\right) = 0\)</span>, then <span class="math inline">\(R_S \sim G\left(\cdot\right)\)</span>. Properties 1-3 allow for a thorough examination of the residuals to check model adequacy and misspecification of the mean structure and link function.</p>
<div id="jittering-for-general-models" class="section level3">
<h3 class="hasAnchor">
<a href="#jittering-for-general-models" class="anchor"></a>Jittering for general models</h3>
<p>The latent method discussed above applies to cumulative link models for ordinal outcomes. For more general models, we can define a surrogate using a technique called <em>jittering</em>. Suppose the true model for an ordinal outcome <span class="math inline">\(\mathcal{Y}\)</span> is</p>
<p><span class="math display">\[
  \mathcal{Y} \sim F_a\left(y; \boldsymbol{X}, \boldsymbol{\beta}\right), \tag{5}
\]</span></p>
<p>where <span class="math inline">\(F\left(\cdot\right)\)</span> is a discrete cumulative distribution function. This model is general enough to cover the cumulative link models (1) and (2), and nearly any parametric or nonparametric model for ordinal outcomes.</p>
<p><span class="citation">D. Liu and Zhang (2017)</span> suggest defining the surrogate <span class="math inline">\(S\)</span> using either of the following two approaches:</p>
<ol style="list-style-type: decimal">
<li>jittering on the outcome scale: <span class="math inline">\(S | \mathcal{Y} = y \sim \mathcal{U}\left[y, y + 1\right]\)</span>;</li>
<li>jittering on the probability scale: <span class="math inline">\(S | \mathcal{Y} = y \sim \mathcal{U}\left[F_a\left(y - 1\right), F_a\left(y\right)\right]\)</span>.</li>
</ol>
<p>Once a surrogate is obtained, we define the surrogate residuals in the same way as Equation (4). In either case, if the hypothesized model is correct, then symmetry around zero still holds; that is <span class="math inline">\(E\left(R_S | \boldsymbol{X}\right) = 0\)</span>. For the latter case, if the hypothesized model is correct then <span class="math inline">\(R_S | \boldsymbol{X} \sim \mathcal{U}\left(-1/2, 1/2\right)\)</span>. In other words, jittering on the probability scale has the additional property that the conditional distribution of <span class="math inline">\(R_S\)</span> given <span class="math inline">\(\boldsymbol{X}\)</span> has an explicit form. This allows for a full examination of the distributional information of the residual.</p>
</div>
<div id="bootstrapping" class="section level3">
<h3 class="hasAnchor">
<a href="#bootstrapping" class="anchor"></a>Bootstrapping</h3>
<p>Since the surrogate residuals are based on random sampling, additional variability is introduced. One way to account for this sample variability and help stabilize any patterns in diagnostic plots is to use the bootstrap <span class="citation">(Efron 1979)</span>.</p>
<p>The procedure for bootstrapping surrogate residuals is similar to the model-based bootstrap algorithm used in linear regression. To obtain the <span class="math inline">\(b\)</span>-th bootstrap replicate of the residuals, <span class="citation">D. Liu and Zhang (2017)</span> suggest the following algorithm:</p>
<p><strong>Step 1</strong> Perform a standard case-wise bootstrap of the original data to obtain the bootstrap sample <span class="math inline">\(\left\{\left(\boldsymbol{X}_{1b}^\star, \mathcal{Y}_{1b}^\star\right), \dots, \left(\boldsymbol{X}_{ nk}^\star, \mathcal{Y}_{nk}^\star\right)\right\}\)</span>.</p>
<p><strong>Step 2</strong> Using the procedure outlined in the previous section, obtain a sample of surrogate residuals <span class="math inline">\(R_{S_{1b}}^\star, \dots, R_{S_{nb}}^\star\)</span> using the bootstrap sample obtained in <strong>Step 1</strong>.</p>
<p>This procedure is repeated a total of <span class="math inline">\(B\)</span> times. For residual-vs-covariate (i.e., <span class="math inline">\(R\)</span>-vs-<span class="math inline">\(x\)</span>) plots and residual-vs-fitted value (i.e., <span class="math inline">\(R\)</span>-vs-<span class="math inline">\(f\left(\boldsymbol{X}, \widehat{\boldsymbol{\beta}}\right)\)</span>) plots, we simply scatter all <span class="math inline">\(B \times n\)</span> residuals on the same plot. This approach is valid since the bootstrap samples are drawn independently. For large data sets, we find it useful to lower the opacity of the data points to help alleviate any issues with overplotting. For Q-Q plots, on the other hand, <span class="citation">D. Liu and Zhang (2017)</span> suggest using the median of the <span class="math inline">\(B\)</span> bootstrap distributions, which is the implementation used in the <code>sure</code> package <span class="citation">(Greenwell, McCarthy, and Boehmke 2017)</span>.</p>
</div>
</div>
<div id="surrogate-residuals-in-r" class="section level2">
<h2 class="hasAnchor">
<a href="#surrogate-residuals-in-r" class="anchor"></a>Surrogate residuals in R</h2>
<p>The <strong>sure</strong> package supports a variety of R packages for fitting cumulative link and other types of models. The supported packages and their corresponding functions are described in Table 2.</p>
<table class="table">
<thead><tr class="header">
<th>Package</th>
<th>Function(s)</th>
<th>Model</th>
<th>Parameterization</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>stats</strong></td>
<td><code>glm</code></td>
<td>binary regression</td>
<td>NA</td>
</tr>
<tr class="even">
<td><strong>MASS</strong></td>
<td><code>polr</code></td>
<td>cumulative link</td>
<td><span class="math inline">\(Pr\left\{\mathcal{Y} \le j\right\}\)</span></td>
</tr>
<tr class="odd">
<td><strong>rms</strong></td>
<td><code>lrm</code></td>
<td>cumulative link</td>
<td><span class="math inline">\(Pr\left\{\mathcal{Y} \ge j\right\}\)</span></td>
</tr>
<tr class="even">
<td></td>
<td><code>lrm</code></td>
<td>logistic regression</td>
<td>NA</td>
</tr>
<tr class="odd">
<td></td>
<td><code>orm</code></td>
<td>cumulative link</td>
<td><span class="math inline">\(Pr\left\{\mathcal{Y} \ge j\right\}\)</span></td>
</tr>
<tr class="even">
<td><strong>ordinal</strong></td>
<td><code>clm</code></td>
<td>cumulative link</td>
<td><span class="math inline">\(Pr\left\{\mathcal{Y} \le j\right\}\)</span></td>
</tr>
<tr class="odd">
<td><strong>VGAM</strong></td>
<td><code>vglm</code></td>
<td>cumulative link</td>
<td><span class="math inline">\(Pr\left\{\mathcal{Y} \le j\right\}\)</span></td>
</tr>
<tr class="even">
<td></td>
<td><code>vgam</code></td>
<td>cumulative link</td>
<td><span class="math inline">\(Pr\left\{\mathcal{Y} \le j\right\}\)</span></td>
</tr>
</tbody>
</table>
<p>Table 2: Ordinal regression modelling packages supported by <strong>sure</strong> and the corresponding parameterization they use for fitting cumulative link models. <br></p>
<p>The <strong>sure</strong> package currently exports four functions:</p>
<ul>
<li>
<code>resids</code>: for constructing surrogate residuals;</li>
<li>
<code>surrogate</code>: for generating the surrogate response values used in the residuals;</li>
<li>
<code>autoplot</code>: for producing various diagnostic plots using <strong>ggplot2</strong> graphics <span class="citation">(Wickham 2009)</span>;</li>
<li>
<code>gof</code>: for simulating <span class="math inline">\(p\)</span>-values from various goodness-of-fit tests.</li>
</ul>
<p>In addition, the package also includes five simulated data sets: <code>df1</code>, <code>df2</code>, <code>df3</code>, <code>df4</code>, and <code>df5</code>. These data sets are used throughout the paper to demonstrate how the surrogate residual can be useful as a diagnostic tool for cumulative link models. The R code used to generate these data sets is available on the projects GitHub page: <a href="https://github.com/koalaverse/sure/blob/master/data-raw/data.R">simulated data link</a>.</p>
<div id="detecting-a-misspecified-mean-structure" class="section level3">
<h3 class="hasAnchor">
<a href="#detecting-a-misspecified-mean-structure" class="anchor"></a>Detecting a misspecified mean structure</h3>
<p>For illustration, the data frame <code>df1</code> contains <span class="math inline">\(n = 2000\)</span> observations from the following cumulative link model:</p>
<p><span class="math display">\[
  Pr\left\{\mathcal{Y} \le j\right\} = \Phi\left(\alpha_j + \beta_1 X + \beta_2 X ^ 2\right), \quad j = 1, 2, 3, 4, \tag{3}
\]</span></p>
<p>where <span class="math inline">\(\alpha_1 = -16\)</span>, <span class="math inline">\(\alpha_2 = -12\)</span>, <span class="math inline">\(\alpha_3 = -8\)</span>, <span class="math inline">\(\beta_1 = -8\)</span>, <span class="math inline">\(\beta_2 = 1\)</span>, and <span class="math inline">\(X \sim \mathcal{U}\left(1, 7\right)\)</span>. These parameters were chosen to ensure that 1) the sample from the latent variable <span class="math inline">\(\mathcal{Z}\)</span> is spread out, rather than clustering in a small interval, and 2) each category of <span class="math inline">\(\mathcal{Y}\)</span> is well represented in the sample; we follow these guidelines throughout the simulated examples. The simulated data for this example are available in the <code>df1</code> data frame from the <strong>sure</strong> package and are loaded automatically with the package; see <code><a href="../reference/df1.html">?df1</a></code> for details. Below, we fit a (correctly specified) probit model using the <code>polr</code> function from the <strong>MASS</strong> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for residual function and sample data sets</span>
<span class="kw">library</span>(sure)  

<span class="co"># Fit a cumulative link model with probit link</span>
<span class="kw">library</span>(MASS)  <span class="co"># for polr function</span>
fit.polr &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/MASS/topics/polr">polr</a></span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">data =</span> df1, <span class="dt">method =</span> <span class="st">"probit"</span>)</code></pre></div>
<p>The code chunk below obtains the SBS residuals (3) from the previously fitted probit model <code>fit.polr</code> using the <strong>PResiduals</strong> package and constructs a couple of diagnostic plots. The results are displayed in Figure 1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Obtain the SBS/probability-scale residuals</span>
<span class="kw">library</span>(PResiduals)
pres &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/PResiduals/topics/presid">presid</a></span>(fit.polr)

<span class="co"># Residual-vs-covariate plot and Q-Q plot</span>
<span class="kw">library</span>(ggplot2)  <span class="co"># for plotting</span>
p1 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> df1<span class="op">$</span>x, <span class="dt">y =</span> pres), <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(x, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">color =</span> <span class="st">"#444444"</span>, <span class="dt">shape =</span> <span class="dv">19</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">geom_smooth</a></span>(<span class="dt">color =</span> <span class="st">"red"</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Probability-scale residual"</span>)

p2 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw">data.frame</span>(<span class="dt">y =</span> pres), <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">sample =</span> y)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_qq">stat_qq</a></span>(<span class="dt">distribution =</span> qunif, <span class="dt">dparams =</span> <span class="kw">list</span>(<span class="dt">min =</span> <span class="op">-</span><span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">1</span>), <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Sample quantile"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Theoretical quantile"</span>)

gridExtra<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="sure_files/figure-html/unnamed-chunk-2-1.png" alt="Figure 1: SBS residual plots for the (correctly specified) probit model fit to the `df1` data set. Left: Residual-vs-covariate plot with a nonparametric smooth (red curve). Right: Q-Q plot of the residuals." width="672"><p class="caption">
Figure 1: SBS residual plots for the (correctly specified) probit model fit to the <code>df1</code> data set. Left: Residual-vs-covariate plot with a nonparametric smooth (red curve). Right: Q-Q plot of the residuals.
</p>
</div>
<p><br></p>
<p><strong>Note:</strong> the reference distribution for the SBS residual is the <span class="math inline">\(\mathcal{U}\left(-1, 1\right)\)</span> distribution.) As can be seen in the left side of Figure (1), the SBS residuals, which are inherently discrete, often display unusual patterns in diagnostic plots, making them less useful as a diagnostic tool. There is a pattern for each of the <span class="math inline">\(J = 4\)</span> classes!</p>
<p>Similarly, wee can use the <code>resids</code> function to obtain the surrogate residuals. This is illustrated in the following code chunk; and the results are displayed in the figure that follows. (<strong>Note:</strong> since the surrogate residuals are based on random sampling, we specify the seed via the <code>set.seed</code> function throughout for reproducibility.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for reproducibility</span>
<span class="kw">set.seed</span>(<span class="dv">101</span>)  
sres &lt;-<span class="st"> </span><span class="kw"><a href="../reference/resids.html">resids</a></span>(fit.polr)

<span class="co"># Residual-vs-covariate plot and Q-Q plot</span>
<span class="kw">library</span>(ggplot2)  <span class="co"># needed for autoplot function</span>

p1 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(sres, <span class="dt">what =</span> <span class="st">"covariate"</span>, <span class="dt">x =</span> df1<span class="op">$</span>x, <span class="dt">xlab =</span> <span class="st">"x"</span>)
p2 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(sres, <span class="dt">what =</span> <span class="st">"qq"</span>, <span class="dt">distribution =</span> qnorm)

gridExtra<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="sure_files/figure-html/unnamed-chunk-3-1.png" alt="Figure 2: Surrogate residual plots for the (correctly specified) probit model fit to the `df1` data set. Left: Residual-vs-covariate plot with a nonparametric smooth (red curve). Right: Q-Q plot of the residuals." width="672"><p class="caption">
Figure 2: Surrogate residual plots for the (correctly specified) probit model fit to the <code>df1</code> data set. Left: Residual-vs-covariate plot with a nonparametric smooth (red curve). Right: Q-Q plot of the residuals.
</p>
</div>
<p><br></p>
<p>The <strong>sure</strong> package also includes <code>autoplot</code> methods for the various classes of models listed in Table 1, so you can just give <code>autoplot</code> the fitted model directly. The benefit of this approach is that the fitted values and reference distribution (used in Q-Q plots) are automatically extracted. For example, to reproduce the Q-Q plot in Figure 2, we could have just used:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for reproducibility</span>
<span class="kw">set.seed</span>(<span class="dv">101</span>) 

<span class="co"># same as top right of Figure 1</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(fit.polr, <span class="dt">what =</span> <span class="st">"qq"</span>)  </code></pre></div>
<div class="figure" style="text-align: center">
<img src="sure_files/figure-html/unnamed-chunk-4-1.png" alt="Figure 3: autoplot option." width="384"><p class="caption">
Figure 3: autoplot option.
</p>
</div>
<p><br></p>
<p>Suppose that we did not include the quadratic term in our fitted model. We would expect a residual-vs-<span class="math inline">\(x\)</span> plot to indicate that such a quadratic term is missing. Below we update the previously fitted model by removing the quadratic term, then update the residual-vs-covariate plots (code not shown). The updated residual plots are displayed in Figure 4.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># remove quadratic term</span>
fit.polr &lt;-<span class="st"> </span><span class="kw">update</span>(fit.polr, y <span class="op">~</span><span class="st"> </span>x) 

<span class="kw">set.seed</span>(<span class="dv">1055</span>)
p1 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(fit.polr, <span class="dt">what =</span> <span class="st">"covariate"</span>, <span class="dt">x =</span> df1<span class="op">$</span>x, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"x"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Surrogate residual"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">""</span>)

p2 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> df1<span class="op">$</span>x, <span class="dt">y =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/PResiduals/topics/presid">presid</a></span>(fit.polr)), <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(x, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">color =</span> <span class="st">"#444444"</span>, <span class="dt">shape =</span> <span class="dv">19</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">geom_smooth</a></span>(<span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">color =</span> <span class="st">"red"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"x"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Probability-scale residual"</span>)


gridExtra<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>) </code></pre></div>
<div class="figure" style="text-align: center">
<img src="sure_files/figure-html/unnamed-chunk-5-1.png" alt="Figure 4: Residual-vs-covariate plots with nonparametric smooths (red curves) for a probit model with a misspecified mean structure fit to the simulated data from model (6). Left: Surrogate residuals. Right: SBS residuals." width="672"><p class="caption">
Figure 4: Residual-vs-covariate plots with nonparametric smooths (red curves) for a probit model with a misspecified mean structure fit to the simulated data from model (6). Left: Surrogate residuals. Right: SBS residuals.
</p>
</div>
<p><br></p>
<p>The SBS residuals gives some indication of a misspecified mean structure, but this only becomes more clear with increasing <span class="math inline">\(J\)</span>, and the plot is still discrete. This is overcome by the surrogate residuals which produces a residual plot not unlike those seen in ordinary linear regression models.</p>
</div>
<div id="detecting-heteroscedasticty" class="section level3">
<h3 class="hasAnchor">
<a href="#detecting-heteroscedasticty" class="anchor"></a>Detecting heteroscedasticty</h3>
<p>One issue that often raises concerns in statistical inference is that of heteroscedasticity; that is, when the error term has non constant variance. Heteroscedasticity can bias the statistical inference and lead to improper standard errors, confidence intervals, and <span class="math inline">\(p\)</span>-values. Therefore, it is imperative to identify heteroscedacticity whenever present and take appropriate action (e.g., transformations, etc.). In ordinary linear regression, this topic has been covered extensively. For categorical models, on the other hand, not much has been proposed in the literature.</p>
<p>As discussed when introducing surrogate residuals, one of the properties of <span class="math inline">\(R_S\)</span> is that, if the model is specified correctly, then <span class="math inline">\(Var\left(R_S | X\right) = c\)</span>, where <span class="math inline">\(c\)</span> is a constant.</p>
<p>For this example, we generated <span class="math inline">\(n = 2000\)</span> observations from the following ordered probit model:</p>
<p><span class="math display">\[
  Pr\left\{\mathcal{Y} \le j\right\} = \Phi\left\{\left(\alpha_j + \beta X\right) / \sigma_X\right\}, \quad j = 1, 2, 3, 4, 5,
\]</span></p>
<p>where <span class="math inline">\(\alpha_1 = -36\)</span>, <span class="math inline">\(\alpha_2 = -6\)</span>, <span class="math inline">\(\alpha_3 = 34\)</span>, <span class="math inline">\(\alpha_4 = 64\)</span>, <span class="math inline">\(\beta = -4\)</span>, <span class="math inline">\(X \sim \mathcal{U}\left(2, 7\right)\)</span>, and <span class="math inline">\(\sigma_X = X ^ 2\)</span>. Notice how the variability is an increasing function of <span class="math inline">\(X\)</span>. These data are available in the <code>df2</code> data frame that is automatically loaded with the <strong>sure</strong> package; see <code><a href="../reference/df2.html">?df2</a></code> for details.</p>
<p>The following block of code uses the <code>orm</code> function from the popular <strong>rms</strong> package to fit a probit model to the simulated data. <strong>Note:</strong> we had to set <code>x = TRUE</code> in the call to <code>orm</code> in order to use the <code>presid</code> function later.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Fit a cumulative link model with probit link</span>
<span class="kw">library</span>(rms)  <span class="co"># for orm function</span>
fit.orm &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/rms/topics/orm">orm</a></span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> df2, <span class="dt">family =</span> <span class="st">"probit"</span>, <span class="dt">x =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>If heteroscedasticity is present, we would expect this to show up in various diagnostic plots, such as a residual-vs-covariate plot. Below we obtain the SBS and surrogate residuals as before and plot them against <span class="math inline">\(X\)</span>. The results are displayed in Figure~.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for reproducibility</span>
<span class="kw">set.seed</span>(<span class="dv">102</span>)  

p1 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(<span class="kw"><a href="../reference/resids.html">resids</a></span>(fit.orm), <span class="dt">what =</span> <span class="st">"covariate"</span>, <span class="dt">x =</span> df2<span class="op">$</span>x, <span class="dt">xlab =</span> <span class="st">"x"</span>)

p2 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> df2<span class="op">$</span>x, <span class="dt">y =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/PResiduals/topics/presid">presid</a></span>(fit.orm)), <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(x, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">color =</span> <span class="st">"#444444"</span>, <span class="dt">shape =</span> <span class="dv">19</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">alpha =</span> <span class="fl">0.25</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">geom_smooth</a></span>(<span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Probability scale residual"</span>)

gridExtra<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="sure_files/figure-html/unnamed-chunk-7-1.png" alt="Figure 5: Residual-vs-covariate plots with nonparametric smooths (red curves) for the simulated heteroscedastic data. Left: Surrogate residuals. Right: SBS residuals." width="672"><p class="caption">
Figure 5: Residual-vs-covariate plots with nonparametric smooths (red curves) for the simulated heteroscedastic data. Left: Surrogate residuals. Right: SBS residuals.
</p>
</div>
<p><br></p>
<p>In Figure (5), it is clear from the plot of the surrogate residuals (left side of Figure (5)) that the variance increases with <span class="math inline">\(X\)</span>, a sign of heteroscedasticity. As a matter of fact, the plot suggests that the true link function has a varying scale parameter, <span class="math inline">\(\sigma = \sigma\left(\boldsymbol{X}\right)\)</span>. The plot of the SBS residuals (right side of Figure (5)), on the other hand, gives no indication of an issue with nonconstant variance.</p>
<p>As outlined in section about jittering, the jittering technique is broadly applicable to virtually all parametric and nonparametric models for ordinal responses. To illustrate, the code chunk below uses the <strong>VGAM</strong> package to fit a <em>vector generalized additive model</em> to the same data using a nonparametric smooth for <span class="math inline">\(x\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(VGAM)  <span class="co"># for vgam and vglm functions</span>
fit.vgam &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/VGAM/topics/vgam">vgam</a></span>(y <span class="op">~</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/VGAM/topics/s">s</a></span>(x), <span class="dt">family =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/VGAM/topics/cumulative">cumulative</a></span>(<span class="dt">link =</span> probit, <span class="dt">parallel =</span> <span class="ot">TRUE</span>),
                 <span class="dt">data =</span> df2)</code></pre></div>
<p>To obtain a surrogate residual using the jittering technique, we can set <code>method = "jitter"</code> in the call to <code>resids</code> or <code>autoplot</code>. There is also the option <code>jitter.scale</code> which can be set to either <code>"probability"</code>, for jittering on the probability scale (the default), or <code>"response"</code>, for jittering on the response scale. In the code chunk below, we use the <code>autoplot</code> function to obtain residual-by-covariate plots using both types of jittering. The results, which are displayed in Figure 6, clearly indicate that the variance increases with increasing <span class="math inline">\(x\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for reproducibility</span>
<span class="kw">set.seed</span>(<span class="dv">103</span>)  

p1 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(fit.vgam, <span class="dt">what =</span> <span class="st">"covariate"</span>, <span class="dt">x =</span> df2<span class="op">$</span>x, <span class="dt">method =</span> <span class="st">"jitter"</span>,
               <span class="dt">xlab =</span> <span class="st">"x"</span>)

p2 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(fit.vgam, <span class="dt">what =</span> <span class="st">"covariate"</span>, <span class="dt">x =</span> df2<span class="op">$</span>x, <span class="dt">method =</span> <span class="st">"jitter"</span>,
               <span class="dt">jitter.scale =</span> <span class="st">"response"</span>, <span class="dt">xlab =</span> <span class="st">"x"</span>)

gridExtra<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(p1, p2, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="sure_files/figure-html/unnamed-chunk-9-1.png" alt="Figure 6: Residual-vs-covariate plots with nonparametric smooths (red curves) from a vector generalized additive model fit to the simulated heteroscedastic data. Left: Jittering on the probability scale (default). Right: Jittering on the response scale." width="672"><p class="caption">
Figure 6: Residual-vs-covariate plots with nonparametric smooths (red curves) from a vector generalized additive model fit to the simulated heteroscedastic data. Left: Jittering on the probability scale (default). Right: Jittering on the response scale.
</p>
</div>
<p><br></p>
</div>
<div id="detecting-a-misspecified-link-function" class="section level3">
<h3 class="hasAnchor">
<a href="#detecting-a-misspecified-link-function" class="anchor"></a>Detecting a misspecified link function</h3>
<p>For this example, we simulated <span class="math inline">\(n = 2000\)</span> observations from the following model</p>
<p><span class="math display">\[
  Pr\left(\mathcal{Y} \le j\right) = G\left(\alpha_j - 8 X + X ^ 2\right), \quad j = 1, 2, 3, 4,
\]</span></p>
<p>where <span class="math inline">\(G\left(\cdot\right)\)</span> is the CDF for the Gumbel (max) distribution (see Table 1), <span class="math inline">\(\alpha_1 = -16\)</span>, <span class="math inline">\(\alpha_2 = -12\)</span>, <span class="math inline">\(\alpha_3 = -8\)</span>, <span class="math inline">\(\beta_1 = -8\)</span>, <span class="math inline">\(\beta_2 = 1\)</span>, and <span class="math inline">\(X \sim \mathcal{U}\left(1, 7\right)\)</span>. The data are available in the data frame <code>df3</code> within the package; see <code><a href="../reference/df3.html">?df3</a></code> for details.</p>
<p>Below we fit a model with various link functions. For this model, however, the correct link function to use is the log-log link. From these models, we construct Q-Q plots of the residuals using <span class="math inline">\(R = 100\)</span> bootstrap replicates. From the Q-Q plots in Figure 7, it is clear that the model with the log-log link (which corresponds to Gumbel (max) errors in the latent variable formulation) is the most appropriate, while the other plots indicate deviations from the hypothesized model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Fit models with various link functions to the simulated data</span>
fit.probit &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/MASS/topics/polr">polr</a></span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">data =</span> df3, <span class="dt">method =</span> <span class="st">"probit"</span>)
fit.logistic &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/MASS/topics/polr">polr</a></span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">data =</span> df3, <span class="dt">method =</span> <span class="st">"logistic"</span>)
fit.loglog &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/MASS/topics/polr">polr</a></span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">data =</span> df3, <span class="dt">method =</span> <span class="st">"loglog"</span>)  <span class="co"># correct link</span>
fit.cloglog &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/MASS/topics/polr">polr</a></span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">data =</span> df3, <span class="dt">method =</span> <span class="st">"cloglog"</span>)

<span class="co"># Construct Q-Q plots of the surrogate residuals for each model</span>
<span class="kw">set.seed</span>(<span class="dv">1056</span>)  <span class="co"># for reproducibility</span>
p1 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(fit.probit, <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">what =</span> <span class="st">"qq"</span>)
p2 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(fit.logistic, <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">what =</span> <span class="st">"qq"</span>)
p3 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(fit.loglog, <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">what =</span> <span class="st">"qq"</span>)
p4 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(fit.cloglog, <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">what =</span> <span class="st">"qq"</span>)

<span class="co"># bottom left plot is correct model</span>
gridExtra<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(p1, p2, p3, p4, <span class="dt">ncol =</span> <span class="dv">2</span>)  </code></pre></div>
<div class="figure" style="text-align: center">
<img src="sure_files/figure-html/unnamed-chunk-10-1.png" alt="Figure 7: Q-Q plots of the residuals for various cumulative link models fit to simulated data with Gumbel (max) errors. Top left: A model with probit link. Top right: A model with logit link. Bottom left: A model with log-log link (i.e., the correct model). Bottom right: A model with complementary log-log link." width="672"><p class="caption">
Figure 7: Q-Q plots of the residuals for various cumulative link models fit to simulated data with Gumbel (max) errors. Top left: A model with probit link. Top right: A model with logit link. Bottom left: A model with log-log link (i.e., the correct model). Bottom right: A model with complementary log-log link.
</p>
</div>
<p><br></p>
<p>Alternatively, we could also use the surrogate residuals to make use of existing distance-based goodness-of-fit (GOF) tests; for example, the Kolmogorov-Smirnov distance. The <code>gof</code> function in <strong>sure</strong> can be used to produce simulated <span class="math inline">\(p\)</span>-values from such tests.</p>
<p>Currently, the <code>gof</code> function supports three goodness-of-fit tests: the Kolmogorov-Smirnov test (<code>test = "ks"</code>), the Anderson-Darling test (<code>test = "ad"</code>), and the Cramer-Von Mises test (<code>test = "cvm"</code>). Below, we use the <code>gof</code> function to simulate <span class="math inline">\(p\)</span>-values from the Anderson-Darling test for each of the four models; we also set <code>nsim</code> to 100 to produce smoother plots and reduce the sampling error induced by the surrogate procedure. The <code>plot</code> method is then used to display the empirical distribution function (EDF) of the simulated <span class="math inline">\(p\)</span>-values. A good fit would imply uniformly distributed <span class="math inline">\(p\)</span>-values; hence, the EDF would be relatively straight with a slope of one. The results, which are displayed in Figure 8, agree with the Q-Q plots from Figure 7 in that the log-log link is the most appropriate for these data. (<strong>Note:</strong> the plotting method for <code>"gof"</code> objects uses base R graphics; hence, we can use the <code>par</code> function to set various graphical parameters.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span>)
<span class="kw">set.seed</span>(<span class="dv">8491</span>)  <span class="co"># for reproducibility</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/VGAM/topics/notdocumentedyet">plot</a></span>(<span class="kw"><a href="../reference/gof.html">gof</a></span>(fit.probit, <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">test =</span> <span class="st">"ad"</span>), <span class="dt">main =</span> <span class="st">""</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/VGAM/topics/notdocumentedyet">plot</a></span>(<span class="kw"><a href="../reference/gof.html">gof</a></span>(fit.logistic, <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">test =</span> <span class="st">"ad"</span>), <span class="dt">main =</span> <span class="st">""</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/VGAM/topics/notdocumentedyet">plot</a></span>(<span class="kw"><a href="../reference/gof.html">gof</a></span>(fit.loglog, <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">test =</span> <span class="st">"ad"</span>), <span class="dt">main =</span> <span class="st">""</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/VGAM/topics/notdocumentedyet">plot</a></span>(<span class="kw"><a href="../reference/gof.html">gof</a></span>(fit.cloglog, <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">test =</span> <span class="st">"ad"</span>), <span class="dt">main =</span> <span class="st">""</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="sure_files/figure-html/unnamed-chunk-11-1.png" alt="Figure 8: EDFs of the simulated $p$-values from an Anderson-Darling GOF test for various cumulative link models fit to simulated data with gumbel errors. Top left: A model with probit link. Top right: A model with logit link. Bottom left: A model with log-log link (i.e., the correct model). Bottom right: A model with complementary log-log link." width="672"><p class="caption">
Figure 8: EDFs of the simulated <span class="math inline">\(p\)</span>-values from an Anderson-Darling GOF test for various cumulative link models fit to simulated data with gumbel errors. Top left: A model with probit link. Top right: A model with logit link. Bottom left: A model with log-log link (i.e., the correct model). Bottom right: A model with complementary log-log link.
</p>
</div>
<p><br></p>
</div>
<div id="checking-the-proportionality-assumption" class="section level3">
<h3 class="hasAnchor">
<a href="#checking-the-proportionality-assumption" class="anchor"></a>Checking the proportionality assumption</h3>
<p>An important feature of the cumulative link model (1) is the proportional odds assumption, which assumes that the mean structure, <span class="math inline">\(f\left(\boldsymbol{X}, \boldsymbol{\beta}\right)\)</span>, remains the same for each of the <span class="math inline">\(J\)</span> categories; for the logit case (see row one of Table 1), this is also referred to as the proportional odds assumption. <span class="citation">Harrell (2001)</span> suggests computing each observation’s contribution to the first derivative of the log likelihood function with respect to <span class="math inline">\(\boldsymbol{\beta}\)</span>, averaging them within each of the <span class="math inline">\(J\)</span> categories, and examining any trends in the residual plots, but these plots can be difficult to interpret. Fortunately, it is relatively straightforward to use the simulated surrogate response values <span class="math inline">\(S\)</span> to check the proportionality assumption.</p>
<p>To illustrate, we generated 2000 observations from each of the following probit models</p>
<p><span class="math display">\[
  Pr\left(\mathcal{Y} \le j\right) = \Phi\left(\alpha_j + \beta_1 X\right), \quad j = 1, 2, 3, \quad \textrm{and} \quad Pr\left(\mathcal{Y} \le j\right) = \Phi\left(\alpha_j + \beta_2 X\right), \quad j = 4, 5, 6,
\]</span></p>
<p>where <span class="math inline">\(\alpha_1 = -1.5\)</span>, <span class="math inline">\(\alpha_2 = 0\)</span>, <span class="math inline">\(\alpha_3 = 1\)</span>, <span class="math inline">\(\alpha_4 = 3\)</span>, <span class="math inline">\(\beta_1 = 1\)</span>, <span class="math inline">\(\beta_2 = 1.5\)</span>, and <span class="math inline">\(X \sim \mathcal{U}\left(-3, 3\right)\)</span>. The data are available in the data frame <code>df4</code> within the package; see <code><a href="../reference/df4.html">?df4</a></code> for details.</p>
<p>Checking the proportionality assumption here amounts to checking whether or not <span class="math inline">\(\beta_1 - \beta_2 = 0\)</span>. As outlined in <span class="citation">D. Liu and Zhang (2017)</span>, we can generate surrogates <span class="math inline">\(S_1 \sim \mathcal{N}\left(-\beta_1 X, 1\right)\)</span> and <span class="math inline">\(S_2 \sim \mathcal{N}\left(-\beta_2 X, 1\right)\)</span>, both conditional on <span class="math inline">\(X\)</span>. We then define the difference <span class="math inline">\(D = S_2 - S_1\)</span> which, conditional on <span class="math inline">\(X\)</span>, follows a <span class="math inline">\(\mathcal{N}\left(\left(\beta_1 - \beta_2\right) X, 1\right)\)</span> distribution. If <span class="math inline">\(\beta_1 - \beta_2 = 0\)</span>, then <span class="math inline">\(D\)</span> should be independent of <span class="math inline">\(X\)</span>. This can be easily checked by plotting <span class="math inline">\(D\)</span> against <span class="math inline">\(X\)</span>. Below, we use the <code>surrogate</code> function to generate the surrogate response values directly (as opposed to the residuals) and generate the <span class="math inline">\(D\)</span>-vs-<span class="math inline">\(X\)</span> plot shown in Figure 9. It is clear that <span class="math inline">\(\beta_1 - \beta_2 \ne 0\)</span>; hence, the proportionality assumption does not hold.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Fit separate models (VGAM should already be loaded)</span>
fit1 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/VGAM/topics/vglm">vglm</a></span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> df4[<span class="dv">1</span><span class="op">:</span><span class="dv">2000</span>, ],
             <span class="kw"><a href="http://www.rdocumentation.org/packages/VGAM/topics/cumulative">cumulative</a></span>(<span class="dt">link =</span> probit, <span class="dt">parallel =</span> <span class="ot">TRUE</span>))
fit2 &lt;-<span class="st"> </span><span class="kw">update</span>(fit1, <span class="dt">data =</span> df4[<span class="dv">2001</span><span class="op">:</span><span class="dv">4000</span>, ])

<span class="co"># Generate surrogate response values</span>
<span class="kw">set.seed</span>(<span class="dv">8671</span>)  <span class="co"># for reproducibility</span>
s1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogate.html">surrogate</a></span>(fit1)
s2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/surrogate.html">surrogate</a></span>(fit2)

<span class="co"># Figure 8</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw">data.frame</span>(<span class="dt">D =</span> s1 <span class="op">-</span><span class="st"> </span>s2, <span class="dt">x =</span> df4[<span class="dv">1</span><span class="op">:</span><span class="dv">2000</span>, ]<span class="op">$</span>x) , <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> x, <span class="dt">y =</span> D)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">color =</span> <span class="st">"#444444"</span>, <span class="dt">shape =</span> <span class="dv">19</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">geom_smooth</a></span>(<span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">color =</span> <span class="st">"red"</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="sure_files/figure-html/unnamed-chunk-12-1.png" alt="Figure 9: Scatterplot of $D = S_1 - S_2$ vs. $x$ with a nonparametric smooth (red curve)." width="576"><p class="caption">
Figure 9: Scatterplot of <span class="math inline">\(D = S_1 - S_2\)</span> vs. <span class="math inline">\(x\)</span> with a nonparametric smooth (red curve).
</p>
</div>
<p><br></p>
</div>
<div id="detecting-interaction-effects" class="section level3">
<h3 class="hasAnchor">
<a href="#detecting-interaction-effects" class="anchor"></a>Detecting interaction effects</h3>
<p>A common challenge in model building is determining whether or not there are important interactions between the predictors in the data. Using the surrogate residuals, it is rather straightforward to determine if such an interaction effect is missing from the assumed model.</p>
<p>For illustration, we generated <span class="math inline">\(n = 2000\)</span> observations from the following ordered probit model</p>
<p><span class="math display">\[
  Pr\left(\mathcal{Y} \le j\right) = \Phi\left(\alpha_j + \beta_1 x_1 + \beta_2 x_2 + \beta_3 x_1 x_2\right), \quad j = 1, 2, 3, 4,
\]</span></p>
<p>where <span class="math inline">\(\alpha_1 = -16\)</span>, <span class="math inline">\(\alpha_2 = -12\)</span>, <span class="math inline">\(\alpha_3 = -8\)</span>, <span class="math inline">\(\beta_1 = -5\)</span>, <span class="math inline">\(\beta_2 = 3\)</span>, <span class="math inline">\(\beta_3 = 10\)</span>, <span class="math inline">\(x_1 \sim \mathcal{U}\left(1, 7\right)\)</span>, and <span class="math inline">\(x_2\)</span> is a factor with levels <code>Treatment</code> and <code>Control</code>. The simulated data are available in the <code>df5</code> data frame loaded with the <strong>sure</strong> package; see <code><a href="../reference/df5.html">?df5</a></code> for details. Below, we fit two probit models using the <code>clm</code> function from the <strong>ordinal</strong> package (which should already be loaded). The first model only corresponds to the simulated control group, while the second model corresponds to the treatment group.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ordinal)  <span class="co"># for clm function</span>
fit1 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ordinal/topics/clm">clm</a></span>(y <span class="op">~</span><span class="st"> </span>x1, <span class="dt">data =</span> df5[df5<span class="op">$</span>x2 <span class="op">==</span><span class="st"> "Control"</span>, ], <span class="dt">link =</span> <span class="st">"probit"</span>)
fit2 &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ordinal/topics/clm">clm</a></span>(y <span class="op">~</span><span class="st"> </span>x1, <span class="dt">data =</span> df5[df5<span class="op">$</span>x2 <span class="op">==</span><span class="st"> "Treatment"</span>, ], <span class="dt">link =</span> <span class="st">"probit"</span>)</code></pre></div>
<p>If the true model contains an interaction term <span class="math inline">\(x_1 x_2\)</span>, but the fitted model does not include it, we can detect this misspecification using the surrogate residuals. We simply plot <span class="math inline">\(R_S\)</span> versus <span class="math inline">\(x_1\)</span> for treatment group, and compare it to the plot of <span class="math inline">\(R_S\)</span> versus <span class="math inline">\(x_1\)</span> for the controls—or better yet, we can just use the surrogate response <span class="math inline">\(S\)</span> instead of <span class="math inline">\(R_S\)</span>. The trends in these two plots should be different. Below, we use <code>ggplot</code> along with the <code>surrogate</code> function to construct such a plot for both fitted models. The results are displayed in Figure~. The plot indicates a negative association between <span class="math inline">\(x_1\)</span> and the outcome within the control group, and a positive association between <span class="math inline">\(x_1\)</span> and the treatment group (i.e., an interaction between <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for reproducibility</span>
<span class="kw">set.seed</span>(<span class="dv">1105</span>)  

<span class="co"># surrogate response values</span>
df5<span class="op">$</span>s &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw"><a href="../reference/surrogate.html">surrogate</a></span>(fit1), <span class="kw"><a href="../reference/surrogate.html">surrogate</a></span>(fit2))

<span class="co"># plot results</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(df5, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> x1, <span class="dt">y =</span> s)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">color =</span> <span class="st">"#444444"</span>, <span class="dt">shape =</span> <span class="dv">19</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_smooth">geom_smooth</a></span>(<span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">color =</span> <span class="st">"red2"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>( <span class="op">~</span><span class="st"> </span>x2) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Surrogate response"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="kw">expression</span>(x[<span class="dv">1</span>]))</code></pre></div>
<div class="figure" style="text-align: center">
<img src="sure_files/figure-html/unnamed-chunk-14-1.png" alt="Figure 10: Scatterplot of the surrogate response $S$ versus $x_1$ with a nonparametric smooth (red line). Left: Control group. Right: Treatment group." width="672"><p class="caption">
Figure 10: Scatterplot of the surrogate response <span class="math inline">\(S\)</span> versus <span class="math inline">\(x_1\)</span> with a nonparametric smooth (red line). Left: Control group. Right: Treatment group.
</p>
</div>
<p><br></p>
</div>
</div>
<div id="bitterness-of-wine" class="section level2">
<h2 class="hasAnchor">
<a href="#bitterness-of-wine" class="anchor"></a>Bitterness of wine</h2>
<p><span class="citation">Randall (1989)</span> performed an experiment on factors determining the bitterness of wine. Two binary treatment factors, temperature and contact (between juice and skin), were controlled while crushing the grapes during wine production. Nine judges each assessed wine from two bottles from each of the four treatment conditions; for a total of <span class="math inline">\(n = 72\)</span>. The response is an ordered factor with levels <span class="math inline">\(1 &lt; 2 &lt; 3 &lt; 4 &lt; 5\)</span>. The data are available in the <strong>ordinal</strong> package; see <code><a href="http://www.rdocumentation.org/packages/ordinal/topics/wine">?ordinal::wine</a></code> for details.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load wine data set</span>
<span class="kw">data</span>(wine, <span class="dt">package =</span> <span class="st">"ordinal"</span>)  
wine.clm &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ordinal/topics/clm">clm</a></span>(rating <span class="op">~</span><span class="st"> </span>temp <span class="op">+</span><span class="st"> </span>contact, <span class="dt">data =</span> wine, <span class="dt">link =</span> <span class="st">"probit"</span>)</code></pre></div>
<p>Since both of the covariates in this model are binary factors, scatterplots are not appropriate for displaying the residual-by-covariate relationships. Instead, the <code>autoplot</code> function in <strong>sure</strong> uses boxplots; a future release is likely to include the additional option for producing nonparametric densities for each level of a factor. The code chunk below uses <code>autoplot</code> along with <code>grid.arrange</code> to produce some standard residual diagnostic plots. The results are displayed in Figure 11. The Q-Q plot and residual-vs-fitted value plot do not indicate any serious model misspecifications. Furthermore, the boxplots reveal that the medians of the surrogate residuals are very close to zero, and the distribution of the residuals within each level appear to be symmetric and have approximately the same variability (with the exception of a few outliers).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for reproducibility</span>
<span class="kw">set.seed</span>(<span class="dv">1225</span>)  

gridExtra<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>( 
  <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(wine.clm, <span class="dt">nsim =</span> <span class="dv">10</span>, <span class="dt">what =</span> <span class="st">"qq"</span>),
  <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(wine.clm, <span class="dt">nsim =</span> <span class="dv">10</span>, <span class="dt">what =</span> <span class="st">"fitted"</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>),
  <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(wine.clm, <span class="dt">nsim =</span> <span class="dv">10</span>, <span class="dt">what =</span> <span class="st">"covariate"</span>, <span class="dt">x =</span> wine<span class="op">$</span>temp,
           <span class="dt">xlab =</span> <span class="st">"Temperature"</span>),
  <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(wine.clm, <span class="dt">nsim =</span> <span class="dv">10</span>, <span class="dt">what =</span> <span class="st">"covariate"</span>, <span class="dt">x =</span> wine<span class="op">$</span>contact,
           <span class="dt">xlab =</span> <span class="st">"Contact"</span>),
  <span class="dt">ncol =</span> <span class="dv">2</span>
)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="sure_files/figure-html/unnamed-chunk-16-1.png" alt="Figure 11: Residual diagnostic plots for the quality of wine example." width="672"><p class="caption">
Figure 11: Residual diagnostic plots for the quality of wine example.
</p>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-analysis-agresti-2010">
<p>Agresti, Alan. 2010. <em>Analysis of Ordinal Categorical Data</em>. Wiley Series in Probability and Statistics. Wiley.</p>
</div>
<div id="ref-pkg-ordinal">
<p>Christensen, R. H. B. 2015. <em>Ordinal—Regression Models for Ordinal Data</em>. <a href="http://www.cran.r-project.org/package=ordinal" class="uri">http://www.cran.r-project.org/package=ordinal</a>.</p>
</div>
<div id="ref-pkg-PResiduals">
<p>Dupont, Charles, Jeffrey Horner, Chun Li, Qi Liu, and Bryan Shepherd. 2016. <em>PResiduals: Probability-Scale Residuals and Residual Correlations</em>. <a href="https://CRAN.R-project.org/package=PResiduals" class="uri">https://CRAN.R-project.org/package=PResiduals</a>.</p>
</div>
<div id="ref-efron-another-1979">
<p>Efron, B. 1979. “Bootstrap Methods: Another Look at the Jackknife.” <em>Annals Fo Statistics</em> 7 (1): 1–26. <a href="http://dx.doi.org/10.1214/aos/1176344552" class="uri">http://dx.doi.org/10.1214/aos/1176344552</a>.</p>
</div>
<div id="ref-pkg-sure">
<p>Greenwell, Brandon, Andrew McCarthy, and Brad Boehmke. 2017. <em>Sure: Surrogate Residuals for Ordinal and General Regression Models</em>. <a href="https://CRAN.R-project.org/package=sure" class="uri">https://CRAN.R-project.org/package=sure</a>.</p>
</div>
<div id="ref-regression-harrell-2001">
<p>Harrell, Frank E. 2001. <em>Regression Modeling Strategies: With Applications to Linear Models, Logistic Regression, and Survival Analysis</em>. Graduate Texts in Mathematics. Springer.</p>
</div>
<div id="ref-pkg-rms">
<p>Harrell Jr, Frank E. 2017. <em>Rms: Regression Modeling Strategies</em>. <a href="https://CRAN.R-project.org/package=rms" class="uri">https://CRAN.R-project.org/package=rms</a>.</p>
</div>
<div id="ref-residuals-li-2012">
<p>Li, Chun, and Bryan E. Shepherd. 2012. “A New Residual for Ordinal Outcomes.” <em>Biometrika</em> 99 (2): 473–80. <a href="http://dx.doi.org/10.1093/biomet/asr073" class="uri">http://dx.doi.org/10.1093/biomet/asr073</a>.</p>
</div>
<div id="ref-residuals-liu-2017">
<p>Liu, Dungang, and Heping Zhang. 2017. “Residuals and Diagnostics for Ordinal Regression Models: A Surrogate Approach.” <em>Journal of the American Statistical Association</em> 0 (ja): 0–0. <a href="http://dx.doi.org/10.1080/01621459.2017.1292915" class="uri">http://dx.doi.org/10.1080/01621459.2017.1292915</a>.</p>
</div>
<div id="ref-graphical-liu-2009">
<p>Liu, Ivy, Bhramar Mukherjee, Thomas Suesse, David Sparrow, and Sung Kyun Park. 2009. “Graphical Diagnostics to Check Model Misspecification for the Proportional Odds Regression Model.” <em>Statistics in Medicine</em> 28 (3): 412–29. <a href="http://dx.doi.org/10.1080/01621459.2017.1292915" class="uri">http://dx.doi.org/10.1080/01621459.2017.1292915</a>.</p>
</div>
<div id="ref-randal-analysis-1989">
<p>Randall, J. H. 1989. “The Analysis of Sensory Data by Generalized Linear Model.” <em>Biometrical Journal</em> 31 (7): 781–93. <a href="http://dx.doi.org/10.1002/bimj.4710310703" class="uri">http://dx.doi.org/10.1002/bimj.4710310703</a>.</p>
</div>
<div id="ref-pkg-MASS">
<p>Venables, W. N., and B. D. Ripley. 2002. <em>Modern Applied Statistics with S</em>. Fourth. New York: Springer. <a href="http://www.stats.ox.ac.uk/pub/MASS4" class="uri">http://www.stats.ox.ac.uk/pub/MASS4</a>.</p>
</div>
<div id="ref-pkg-ggplot2">
<p>Wickham, Hadley. 2009. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="http://ggplot2.org" class="uri">http://ggplot2.org</a>.</p>
</div>
<div id="ref-pkg-VGAM">
<p>Yee, Thomas W. 2017. <em>VGAM: Vector Generalized Linear and Additive Models</em>. <a href="https://CRAN.R-project.org/package=VGAM" class="uri">https://CRAN.R-project.org/package=VGAM</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#surrogate-residuals">Surrogate residuals</a></li>
      <li><a href="#surrogate-residuals-in-r">Surrogate residuals in R</a></li>
      <li><a href="#bitterness-of-wine">Bitterness of wine</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Brandon Greenwell, Brad Boehmke, Andrew McCarthy.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
